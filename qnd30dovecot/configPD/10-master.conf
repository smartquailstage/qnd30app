##########################
# Dovecot Master Configuration
##########################

# Global master process settings
# Habilitar el uso de múltiples procesos para manejar cargas de trabajo.
# Estos procesos son gestionados por el proceso maestro.
service_count = 0 # 0 significa que Dovecot ajustará automáticamente la cantidad de procesos.
service_max = 1024 # Número máximo de procesos para manejar conexiones.
process_min_avail = 1 # Número mínimo de procesos que deben estar disponibles.
process_limit = 100 # Límite de procesos que pueden estar activos simultáneamente.


######################
# Auth service
######################
service auth {
  unix_listener auth-userdb {
    # Este socket se utiliza para comunicar el servicio de autenticación con otros servicios, como IMAP, POP3 o SMTP.
    path = /var/spool/postfix/private/auth  # El path del socket para la autenticación.
    mode = 0660
    user = dovecot
    group = dovecot
  }

  unix_listener /var/spool/postfix/private/auth {
    # Este es el socket que Postfix utilizará para autenticar usuarios.
    mode = 0666
    user = postfix
    group = postfix
  }

  # Configuración adicional de autenticación si se usa PAM o una base de datos.
  # unix_listener /var/spool/postfix/private/auth-worker {
  #   mode = 0600
  #   user = dovecot
  #   group = dovecot
  # }
}

######################
# LMTP service
######################
service lmtp {
  unix_listener lmtp {
    # El servicio LMTP (Local Mail Transfer Protocol) para entrega de correo interno.
    # Postfix se conecta a este socket para enviar los correos entregados al buzón de usuario.
    path = /var/spool/postfix/private/dovecot-lmtp
    mode = 0660
    user = dovecot
    group = dovecot
  }

  # Configuración de la cantidad mínima y máxima de procesos disponibles para LMTP.
  process_min_avail = 1
  client_limit = 1000  # Número máximo de clientes simultáneos permitidos.
}

######################
# IMAP service
######################
service imap-login {
  inet_listener imap {
    # Servicio IMAP escuchando en el puerto 143.
    port = 143
    # Si deseas habilitar SSL para IMAP, también puedes agregar:
    # ssl = yes
  }

  inet_listener imaps {
    # Servicio IMAPS escuchando en el puerto 993 con SSL habilitado.
    port = 993
    ssl = yes
    ssl_cert = </etc/ssl/certs/fullchain.pem  # Ruta del certificado SSL.
    ssl_key = </etc/ssl/private/privkey.pem  # Ruta de la clave SSL.
  }

  # Configuración de los límites de clientes para el servicio IMAP.
  process_min_avail = 1
  client_limit = 1000
  service_count = 1  # Ajustado para asegurar que haya un proceso disponible.
}

######################
# POP3 service
######################
service pop3-login {
  inet_listener pop3 {
    # Desactivar el servicio POP3 si no lo necesitas (puedes configurar el puerto a 0 para desactivarlo).
    port = 0
  }

  inet_listener pop3s {
    # POP3 con SSL habilitado.
    port = 995
    ssl = yes
    ssl_cert = </etc/ssl/certs/fullchain.pem  # Ruta del certificado SSL.
    ssl_key = </etc/ssl/private/privkey.pem  # Ruta de la clave SSL.
  }

  process_min_avail = 1
  client_limit = 1000
  service_count = 0  # Mantén 0 si no necesitas procesos adicionales.
}


######################
# Worker Services
######################
service auth-worker {
  # Proceso de trabajo para la autenticación.
  user = dovecot  # El usuario bajo el que se ejecutará el proceso worker.
}

# Configuración del grupo privilegiado para correo.
mail_privileged_group = mail

######################
# Listening configuration
######################
# Dovecot escuchará todas las interfaces disponibles
listen = *

######################
# Logging Configuration
######################
log_path = /var/log/dovecot.log
info_log_path = /var/log/dovecot-info.log
debug_log_path = /dev/stdout

verbose_proctitle = yes  # Habilita los títulos de procesos detallados.
